# ðŸŒ€ Crazyflie Controllers Benchmark Framework
![CI](https://github.com/kalesha681/Crazyflie-Controllers/actions/workflows/ci.yml/badge.svg)
![Python](https://img.shields.io/badge/python-3.10+-blue.svg)
![License](https://img.shields.io/badge/license-MIT-green.svg)
![Code Style](https://img.shields.io/badge/code%20style-black-000000.svg)

### A Research-Grade, Reproducible Pipeline for Evaluating Quadrotor Control Architectures

This repository implements a robust, extensible, and scientifically reproducible framework for benchmarking control algorithms on the [Bitcraze Crazyflie 2.1](https://www.bitcraze.io/products/crazyflie-2-1/) quadrotor using PyBullet simulation.

The system is designed to meet research-lab software standards, featuring strict abstraction contracts, deterministic experiments, rigorous logging, and CI-verified correctness.

**ðŸ“„ Full Technical Report â†’ [REPORT.md](REPORT.md)**

## 1. ðŸŽ¯ Research Objective

This project evaluates and compares three fundamental control strategies widely used in quadrotor research:

*   **Cascaded PID Control** â€” Linear baseline
*   **Sliding Mode Control (SMC)** â€” Nonlinear & robust
*   **Linear Model Predictive Control (MPC)** â€” Optimal & predictive

Controllers are scored on:
*   RMSE (tracking error)
*   Control Effort ($\int u^2 dt$)
*   Transient Performance
*   Failure-case behavior

All experiments are **deterministic**, ensuring results are fully reproducible.

## 2. ðŸ§± System Architecture

The project follows a strict `src/` package layout, enabling clean packaging (`pip install -e .`), testability, and CI compliance.

```
crazyflie_controllers/
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ run.py                 # Unified CLI for all experiments
â”œâ”€â”€ src/crazyflie_controllers/
â”‚   â”œâ”€â”€ controllers/           # PID, SMC, MPC (Template Method Pattern)
â”‚   â”œâ”€â”€ trajectories/          # Circle, Eight, Square, Triangle, Step
â”‚   â””â”€â”€ utils/
â”‚       â””â”€â”€ logging.py         # Strict CSV schema enforcement
â”œâ”€â”€ outputs/
â”‚   â”œâ”€â”€ data/                  # Generated logs (ignored by Git)
â”‚   â””â”€â”€ plots/                 # Benchmark plots (ignored by Git)
â”œâ”€â”€ tests/                     # Comprehensive pytest suite
â””â”€â”€ requirements.txt
```

### âœ”ï¸ Key Design Principles
*   **Absolute imports only** (no `sys.path` hacks)
*   **Fail-fast error handling** for all controllers & trajectories
*   **Strict reproducibility** via pinned dependencies + seeded RNG
*   **CI governance** (linting, formatting, tests, packaging checks)
*   **Separation of Concerns** between execution, algorithms, trajectories, logging

## 3. ðŸ§© Abstraction Contracts

### Controller Interface (Template Method Pattern)
All controllers inherit from `BaseController`, which enforces:
```python
compute_control(state, reference, dt) -> np.ndarray
reset()
```
*   `compute_control()` performs validation (shapes, NaNs, types)
*   `_compute_control()` contains controller-specific logic

This ensures **Consistency** across controllers, **Zero tolerance** for silent errors, and **Clean extension** for future controllers.

### Trajectory Interface
Every trajectory inherits from `BaseTrajectory`:
```python
get_target(t) -> (pos, vel, acc, yaw)
```
Output must be **Deterministic**, **Finite**, and **Correctly shaped**.

### Strict Logging Schema
All logs follow an enforced 20-column CSV:
```csv
time,
x, y, z, 
vx, vy, vz,
roll, pitch, yaw,
x_ref, y_ref, z_ref,
ex, ey, ez,
u1, u2, u3, u4
```
The logger rejects malformed frames, rejects NaN/Inf values, injects metadata headers, and guarantees analysis integrity.

## 4. ðŸš€ Quick Start

### Installation
```bash
# Clone
git clone https://github.com/kalesha681/Crazyflie-Controllers.git
cd Crazyflie-Controllers

# Install Environment (Virtualenv recommended)
pip install -r requirements.txt

# Install Package (Editable mode)
pip install -e .
```

### Running Experiments
The entire system runs through a single unified CLI: **`scripts/run.py`**

**1. Basic Run (Visual)**
Simulate SMC controller on a Figure-8 trajectory with GUI enabled.
```bash
python scripts/run.py --controller smc --trajectory eight --gui
```

**2. Full Benchmark (Headless)**
Generate data for all controllers on a Circle trajectory to compare performance.
```bash
python scripts/run.py --controller pid smc mpc --trajectory circle --no-gui
```

**3. Generate Analysis**
(Note: Analysis plots are auto-generated by the run script if `--plot` is active).
Check `outputs/plots/` for results.

### Command Options
| Flag | Description | Default |
| :--- | :--- | :--- |
| `--controller` | List of controllers (`pid`, `smc`, `mpc`) | Required |
| `--trajectory` | Reference path (`circle`, `eight`, `step`...) | Required |
| `--duration` | Simulation time in seconds | `12.0` |
| `--gui` | Enable PyBullet 3D visualization | `False` |
| `--seed` | Random seed for deterministic physics | `42` |

## 5. ðŸ“Š Results Summary

![Figure-8 Tracking](docs/assets/results_eight.png)
*Figure 1: 2D Trajectory Tracking*

![Figure-8 Error](docs/assets/error_eight.png)
*Figure 2: Position Error Norm over Time (Demonstrates SMC/MPC precision vs PID lag)*

*Average RMSE (Figure-8, 12s period)*

| Controller | RMSE (m) | Notes |
| :--- | :--- | :--- |
| **PID** | 0.0343 | Linear baseline, phase lag |
| **MPC** | 0.0130 | Strong predictive tracking |
| **SMC** | **0.0120** | **Best performance**, robust to disturbances |

A full discussion of controller behaviorsâ€”including failure casesâ€”is provided in [REPORT.md](REPORT.md).

## 6. ðŸ§ª Verification & CI Governance

The repository is validated end-to-end using GitHub Actions:

*   âœ”ï¸ **Black** â€” Style Enforcement
*   âœ”ï¸ **Flake8** â€” Syntax & Logic Linting
*   âœ”ï¸ **Pytest** â€” Automated Functional Tests
*   âœ”ï¸ **Packaging** â€” `pip install .` verified in clean environment

This ensures no regressions, no formatting drift, no broken imports, and no silent failures.

## 7. ðŸ” Reproducibility Policy

This repository guarantees:
*   Pinned dependencies
*   Seeded experiments
*   Deterministic behavior
*   Fully regenerable outputs

`outputs/` contains only derived artifacts, never manually edited data.

## 8. ðŸ› ï¸ Extending the Framework

Future researchers may add:
*   LQR, NMPC, Adaptive, or Backstepping controllers
*   Disturbance injection modules
*   Kalman Filters (EKF/UKF) for state estimation
*   Real Crazyflie hardware adapters

The template-method architecture ensures compatibility with minimal effort.

## 9. ðŸ“œ Citation

If you use this framework in research:
> Shaik, Kalesha. "Crazyflie Controllers Benchmark Framework."
> 2025. GitHub Repository.

### ðŸ‘¤ Author

**Kalesha Shaik**
Connect with me on: [LinkedIn](https://www.linkedin.com/in/kalesha681)